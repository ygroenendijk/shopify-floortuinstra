{%- liquid
  capture icons
    echo '<div class="field__icons">'
    render 'icons', icon: 'checkmark', icon_class: 'w-5'
    render 'icons', icon: 'cross', icon_class: 'w-5'
    echo '</div>'
  endcapture

  capture name_str
    render 'format-translation', namespace: 'templates.contact.form', key: 'name', fallback: 'Name'
  endcapture

  capture email_str
    render 'format-translation', namespace: 'templates.contact.form', key: 'email', fallback: 'Email address'
  endcapture

  capture phone_str
    render 'format-translation', namespace: 'templates.contact.form', key: 'phone', fallback: 'Phone number'
  endcapture

  capture comment_str
    render 'format-translation', namespace: 'templates.contact.form', key: 'comment', fallback: 'Comment'
  endcapture
-%}

{%- comment -%} Capture container content {%- endcomment -%}
{%- capture container_content -%}
  {%- form 'contact', id: 'contact-form', class: 'form grid grid-cols-2 gap-x-element-spacing' -%}

    {% comment %} Name {% endcomment %}
    <div class="field col-span-2 md:col-span-1">
      <label class="field__label" for="contact-form__name">
        {{- name_str -}}
      </label>
      <input
        type="text"
        name="contact[{{ name_str }}]"
        id="contact-form__name"
        class="field__input"
        autocomplete="name"
        value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
        placeholder="{{ name_str }}"
      >
      {{- icons -}}
    </div>

    {% comment %} Email {% endcomment %}
    <div class="field col-span-2 md:col-span-1">
      <label class="field__label" for="contact-form__email">
        {{- email_str -}}
      </label>
      <input
        type="email"
        name="contact[email]"
        autocomplete="email"
        id="contact-form__email"
        class="field__input"
        spellcheck="false"
        autocapitalize="off"
        value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
        aria-required="true"
        required
        {% if form.errors contains 'email' %}
          aria-invalid="true"
          aria-describedby="contact-form__email-error"
        {% endif %}
        placeholder="{{ email_str }}"
      >
      {{- icons -}}
      {%- if form.errors contains 'email' -%}
        <div class="field__message field__message--error" id="contact-form__email-error">
          <span class="sr-only">
            {%
              render "format-translation",
              namespace: "accessibility",
              key: "error",
              fallback: "Error"
            -%}
          </span>
          {{- form.errors.translated_fields['email'] | capitalize }}
          {{ form.errors.messages['email'] -}}
        </div>
      {%- else -%}
        <div class="field__message field__message--error">
          {%-
            render "format-translation",
            namespace: "customer.login_page",
            key: "email_message_error",
            fallback: "This email is not in the correct format."
          -%}
        </div>
      {%- endif -%}
    </div>

    {% comment %} Phone number {% endcomment %}
    <div class="field col-span-2">
      <label class="field__label" for="contact-form__phone">
        {{- phone_str -}}
      </label>
      <input
        type="tel"
        name="contact[{{ phone_str }}]"
        id="contact-form__phone"
        class="field__input"
        autocomplete="tel"
        pattern="[0-9\-]*"
        value="{% if form.phone %}{{ form.phone }}{% elsif customer %}{{ customer.phone }}{% endif %}"
        placeholder="{{ phone_str }}"
      >
      {{- icons -}}
    </div>

    {% comment %} Comment {% endcomment %}
    <div class="field col-span-2">
      <label class="field__label" for="contact-form__body">{{ comment_str }}</label>
      <textarea
        id="contact-form__body"
        class="field__textarea"
        rows="10"
        name="contact[{{ comment_str }}]"
        placeholder="{{ comment_str }}"
      >
        {{- form.body -}}
      </textarea>
      {{- icons -}}
    </div>

    {% comment %} Actions {% endcomment %}
    <div class="form__actions col-span-2">
      <button type="submit" class="button {{ section.settings.button_color_scheme }}">
        {%-
          render "format-translation",
          namespace: "templates.contact.form",
          key: "send",
          fallback: "Send"
        -%}
      </button>
    </div>

    {%- comment -%} Succes message {%- endcomment -%}
    {%- if form.posted_successfully? -%}
      <div class="field__message" tabindex="-1" autofocus>
        {%-
          render "format-translation",
          namespace: "templates.contact.form",
          key: "post_success",
          fallback: "Thank you for subscribing to our newsletter"
        -%}
      </div>

    {% comment %} Error message {% endcomment %}
    {%- elsif form.errors -%}
      <div class="field__message field__message--error">
        <p aria-roledescription="alert" tabindex="-1" autofocus>
          {%
            render "format-translation",
            namespace: "templates.contact.form",
            key: "error_heading",
            fallback: "Please adjust the following:"
          -%}
        </p>
      </div>
      <a href="#contact-form__email" class="link">
        {{- form.errors.translated_fields['email'] | capitalize }}
        {{ form.errors.messages['email'] -}}
      </a>
    {%- endif -%}
  {%- endform -%}
{%- endcapture -%}

{%- comment -%} Import styles {%- endcomment -%}
{%- liquid
  render 'import-styles', file_name: 'component-form.css', force: true
-%}

{%- liquid
  # Container class
  assign container_class = 'contact-form'
  if section.settings.container_width != blank
    assign container_class = container_class | append: ' ' | append: section.settings.container_width
  endif
  if section.settings.color_scheme != blank
    assign container_class = container_class | append: ' container--background my-0 ' | append: section.settings.color_scheme
  endif

  # Container title
  assign container_title = page.title | escape
  if section.settings.heading != blank
    assign container_title = section.settings.heading | escape
  endif
-%}

{%- comment -%} Render the content {%- endcomment -%}
{%- render 'format-container', title_tag: section.settings.heading_element, title_class: section.settings.heading_size, title: container_title, content: container_content, class: container_class -%}

{% schema %}
  {
    "name": "Contact form",
    "tag": "section",
    "class": "contact-form__section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Contact us"
      },
      {
        "type": "select",
        "id": "heading_element",
        "label": "Heading element",
        "default": "h2",
        "info": "Change the element of the heading for SEO.",
        "options": [
          {
            "value": "h1",
            "label": "H1"
          },
          {
            "value": "h2",
            "label": "H2"
          },
          {
            "value": "h3",
            "label": "H3"
          },
          {
            "value": "h4",
            "label": "H4"
          },
          {
            "value": "h5",
            "label": "H5"
          },
          {
            "value": "h6",
            "label": "H6"
          }
        ]
      },
      {
        "type": "select",
        "id": "heading_size",
        "label": "Heading size",
        "default": "h4",
        "info": "Change the style of the heading to only influence the look and feel.",
        "options": [
          {
            "value": "h1",
            "label": "H1"
          },
          {
            "value": "h2",
            "label": "H2"
          },
          {
            "value": "h3",
            "label": "H3"
          },
          {
            "value": "h4",
            "label": "H4"
          },
          {
            "value": "h5",
            "label": "H5"
          },
          {
            "value": "h6",
            "label": "H6"
          }
        ]
      },
      {
        "type": "select",
        "id": "container_width",
        "default": "container--sm",
        "label": "Container width",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "container--sm",
            "label": "Small"
          },
          {
            "value": "container--md",
            "label": "Medium"
          },
          {
            "value": "container--wide",
            "label": "Wide"
          }
        ]
      },
      {
        "type": "select",
        "id": "color_scheme",
        "default": "",
        "label": "Color scheme",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "color-scheme color-scheme--primary",
            "label": "Primary",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--secondary",
            "label": "Secondary",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--accent",
            "label": "Accent",
            "group": "Theme"
          },
          {
            "value": "color-scheme color-scheme--white",
            "label": "White",
            "group": "Standard"
          },
          {
            "value": "color-scheme color-scheme--gray",
            "label": "Gray",
            "group": "Standard"
          },
          {
            "value": "color-scheme color-scheme--black",
            "label": "Black",
            "group": "Standard"
          }
        ]
      },
      {
        "type": "select",
        "id": "button_color_scheme",
        "default": "button--primary",
        "label": "Button type",
        "options": [
          {
            "value": "",
            "label": "Default"
          },
          {
            "value": "button--primary",
            "label": "Primary"
          },
          {
            "value": "button--secondary",
            "label": "Secondary"
          },
          {
            "value": "button--outline",
            "label": "Outline"
          },
          {
            "value": "button--outline-white",
            "label": "Outline white"
          },
          {
            "value": "button--link",
            "label": "Link"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Contact form"
      }
    ],
    "disabled_on": {
      "groups": ["header"]
    }
  }
{% endschema %}
