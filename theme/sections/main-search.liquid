{%- liquid
  # Import styles for this section
  render 'import-styles', file_name: 'component-form.css', force: true

  capture search_str
    render 'render-translation', namespace: 'sections.main_search', key: 'search', fallback: 'Search'
  endcapture

  assign grid_classes = 'search-results gap-base'
  assign grid_item_classes = 'col-span-6 md:col-span-4 lg:col-span-3'
-%}

{%- capture container_content -%}

  {% comment %} Results count {% endcomment %}
  <p class="text-center">
    {%- liquid
      if search.performed
        if search.results_count == 0
          echo 'sections.main_search.no_results' | t: terms: search.terms
        else
          echo 'sections.main_search.results_with_count' | t: terms: search.terms, count: search.results_count
        endif
      else
        echo search_str
      endif
    -%}
  </p>

  {% comment %} Search form {% endcomment %}
  <form action="{{ routes.search_url }}" method="get" role="search" class="mb-10 grid grid-cols-12">
    <div class="relative col-span-12  md:col-span-6 md:col-start-4 lg:col-span-4 lg:col-start-5">
      <div class="field relative mb-0">
        <label class="field__label sr-only" for="search-in-template" aria-hidden="true">
          {{ search_str }}
        </label>
        <input
          class="field__input"
          id="search-in-template"
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="{{ search_str }}"
        >
        <button type="submit" class="search__button absolute end-4 top-2/4 block -translate-y-2/4 states:text-primary" aria-label="{{ search_str }}">
          {%- render 'icons', icon: 'search', icon_class: 'w-6' -%}
        </button>
      </div>
      <input name="options[prefix]" type="hidden" value="last">
    </div>
  </form>

    {% comment %} Search results {% endcomment %}
    {%- if search.performed and search.results.size > 0 -%}
      {%- paginate search.results by 16 -%}

        {%- for item in search.results -%}
          {%- case item.object_type -%}
            {%- when 'product' -%}
              {%- capture results_products -%}
                {{ results_products }}
                <li class="{{ grid_item_classes }}">
                  {%- render 'product-card', product_object: item -%}
                </li>
              {%- endcapture -%}
            {%- when 'article' -%}
              {%- capture results_articles -%}
                {{ results_articles }}
              <li class="{{ grid_item_classes }}">
                {%- render 'article-card', article: item -%}
              </li>
              {%- endcapture -%}
            {%- when 'page' -%}
              {%- capture results_pages -%}
                {{ results_pages }}
              <li class="">
                {%- render 'page-card', page: item -%}
              </li>
              {%- endcapture -%}
            {%- endcase -%}
        {%- endfor -%}

      {% comment %} Product results {% endcomment %}
      {%- if results_products -%}
        <h2 class="h4">{%- render 'render-translation', namespace: 'sections.predictive_search', key: 'products', fallback: 'products' -%}</h2>
        <ul class="{{ grid_classes }} grid grid-cols-12">
          {{ results_products }}
        </ul>
        <hr class="bg-gray-100">
      {%- endif -%}

      {% comment %} Blog article results {% endcomment %}
      {%- if results_articles -%}
        <h2 class="h4">{%- render 'render-translation', namespace: 'sections.predictive_search', key: 'blog', fallback: 'Articles' -%}</h2>
        <ul class="{{ grid_classes }} grid grid-cols-12">
          {{ results_articles }}
        </ul>
        <hr class="bg-gray-100">
      {%- endif -%}

      {% comment %} Page results {% endcomment %}
      {%- if results_pages -%}
        <h2 class="h4">{%- render 'render-translation', namespace: 'sections.predictive_search', key: 'pages', fallback: 'Pages' -%}</h2>
        <ul class="{{ grid_classes }} flex flex-col">
          {{ results_pages }}
        </ul>
      {%- endif -%}

      {%- liquid
        if paginate.pages > 1
          render 'pagination', paginate: paginate, class: 'pagination-wrapper-small mt-8'
        endif
      -%}
      {%- endpaginate -%}
    {%- endif -%}
{%- endcapture -%}

{%- capture container_title -%}
  {%- render 'render-translation', namespace: 'sections.main_search', key: 'title', fallback: 'Search results' -%}
{%- endcapture -%}

{%- comment -%} Render the content {%- endcomment -%}
{%- render 'render-container-content', class: 'mt-8', header_class: 'mb-8', title: container_title, title_tag: 'h1', title_class: 'h2 text-center', content: container_content -%}

{% schema %}
  {
    "name": "Search results",
    "tag": "section",
    "class": "main-search-section",
    "settings": [
      {
        "type": "header",
        "content": "Blog card"
      },
      {
        "type": "checkbox",
        "id": "article_show_date",
        "default": true,
        "label": "Show date"
      },
      {
        "type": "checkbox",
        "id": "article_show_author",
        "default": false,
        "label": "Show author"
      }
    ]
  }
{% endschema %}
