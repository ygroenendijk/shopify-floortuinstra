{%- comment -%} Capture translations to use multiple times {%- endcomment -%}
{%- liquid
  capture order_nr_str
    render 'render-translation', namespace: 'customer.orders', key: 'order_number', fallback: 'Order number'
  endcapture

  capture order_date_str
    render 'render-translation', namespace: 'customer.orders', key: 'date', fallback: 'Order date'
  endcapture

  capture payment_status_str
    render 'render-translation', namespace: 'customer.orders', key: 'payment_status', fallback: 'Payment status'
  endcapture

  capture fulfillment_status_str
    render 'render-translation', namespace: 'customer.orders', key: 'fulfillment_status', fallback: 'Fulfillment status'
  endcapture

  capture total_str
    render 'render-translation', namespace: 'customer.orders', key: 'total', fallback: 'Total'
  endcapture

  capture page_title
    render 'render-translation', namespace: 'customer.account', key: 'details', fallback: 'Account details'
  endcapture
-%}

{%- capture container_content -%}

  {%- comment -%} Customer info {%- endcomment -%}
  <div class="account__customer-info is-order-2-md col-span-12 mb-8 grid grid-cols-1 gap-4 text-base leading-7 lg:order-2 lg:col-span-3 lg:col-start-10 lg:mb-0 xl:col-span-2 xl:col-start-11">
    {%- if customer.name != blank -%}
      <h2 class="h5">
        {{- customer.name -}}
      </h2>
    {%- endif -%}
    {%- if customer.email != blank -%}
      <p>
        {{- customer.email -}}
      </p>
    {%- endif -%}
    {{ customer.default_address | format_address }}
    {% if customer.phone != blank -%}
      <p>
        {{- customer.phone | strip -}}
      </p>
    {%- endif -%}
    <a href="{{ routes.account_addresses_url }}" class="button button--primary button--lg justify-self-start">
      {%-
        render 'render-translation',
        namespace: 'customer.account',
        key: 'edit_details',
        fallback: 'Edit details'
      -%}
    </a>
    <a href="{{ routes.account_logout_url }}" class="button button--outline button--lg justify-self-start">
      {%-
        render 'render-translation',
        namespace: 'customer',
        key: 'log_out',
        fallback: 'Log out'
      -%}
    </a>
  </div>

  {%- comment -%} Orders {%- endcomment -%}
  <div class="account__orders col-span-12 col-start-1 lg:order-1 lg:col-span-8 xl:col-span-9">
    {% paginate customer.orders by 20 %}
      {%- if customer.orders.size > 0 -%}
        <table role="table" class="account__order-history relative w-full table-auto border-collapse">
          <caption class="sr-only">
            {%-
              render 'render-translation',
              namespace: 'customer.orders',
              key: 'title',
              fallback: 'Orders'
            -%}
          </caption>
          <thead role="rowgroup" class="hidden text-left text-sm md:table-header-group">
            {%- assign th_class = 'pt-0 pl-0 pr-4 pb-6 align-top md:w-52 last:w-24' -%}
            <tr role="row">
              <th id="ColumnOrder" scope="col" role="columnheader" class="{{ th_class }}">
                {{- order_nr_str -}}
              </th>
              <th id="ColumnDate" scope="col" role="columnheader" class="{{ th_class }}">
                {{- order_date_str -}}
              </th>
              <th id="ColumnPayment" scope="col" role="columnheader" class="{{ th_class }}">
                {{- payment_status_str -}}
              </th>
              <th id="ColumnFulfillment" scope="col" role="columnheader" class="{{ th_class }}">
                {{- fulfillment_status_str -}}
              </th>
              <th id="ColumnTotal" scope="col" role="columnheader" class="{{ th_class }}">
                {{- total_str -}}
              </th>
            </tr>
          </thead>
          <tbody role="rowgroup" class="">
            {%- for order in customer.orders -%}
              {%- assign td_class = 'text-sm py-1 md:py-4 md:pl-0 md:pr-4 text-left align-top md:w-52 last:w-24' -%}
              <tr role="row" class="flex flex-col justify-start border-b  py-3 md:table-row md:py-0">
                <td id="RowOrder" role="cell" headers="ColumnOrder" data-label="{{ order_nr_str }}" class="{{ td_class }}">
                  <a
                    href="{{ order.customer_url }}"
                    aria-label="{{ 'customer.orders.order_number_link' | t: number: order.name }}"
                    class="font-bold no-underline states:no-underline"
                  >
                    {{ order.name }}
                  </a>
                </td>
                <td headers="RowOrder ColumnDate" role="cell" data-label="{{- order_date_str -}}" class="{{ td_class }}">
                  {{ order.created_at | time_tag: '%b %d, %Y' }}
                </td>
                <td headers="RowOrder ColumnPayment" role="cell" data-label="{{- payment_status_str -}}" class="{{ td_class }}">
                  {{ order.financial_status_label }}
                </td>
                <td headers="RowOrder ColumnFulfillment" role="cell" data-label="{{- fulfillment_status_str -}}" class="{{ td_class }}">
                  {{ order.fulfillment_status_label }}
                </td>
                <td headers="RowOrder ColumnTotal" role="cell" data-label="{{- total_str -}}" class="{{ td_class }}">
                  {{ order.total_price | money_with_currency }}
                </td>
              </tr>
            {%- endfor -%}
          </tbody>
        </table>
      {%- else -%}
        <h2 class="h5">
          {%-
            render 'render-translation',
            namespace: 'customer.orders',
            key: 'title',
            fallback: 'Orders'
          -%}
        </h2>
        <p>
          {%-
            render 'render-translation',
            namespace: 'customer.orders',
            key: 'none',
            fallback: 'No orders'
          -%}
        </p>
      {%- endif -%}

      {%- comment -%} Pagination {%- endcomment -%}
      {%- liquid
        if paginate.pages > 1
          render 'pagination', paginate: paginate
        endif
      -%}
    {% endpaginate %}
  </div>
{%- endcapture -%}

{%- comment -%} Render the account header {%- endcomment -%}
{%- render 'account-header' -%}

{%- comment -%} Render the content {%- endcomment -%}
{%- render 'render-container-content', class: 'account', content: container_content, content_class: 'account__grid grid grid-cols-12' -%}

{% schema %}
  {
    "name": "Account",
    "blocks": []
  }
{% endschema %}
