{%- comment -%}
  Optional parameters
  - prefix
  - predictive_search_enabled
  - max_results

  Example
  {%- render 'search-form', predictive_search_enabled: settings.predictive_search_enabled, prefix: 'mobile' -%}
{%- endcomment -%}

{%- comment -%} Set prefix, div or web component. {%- endcomment -%}
{%- liquid
  unless prefix
    assign prefix = ''
  endunless
  assign search_form_element = 'div'
  if predictive_search_enabled == true
    comment
      Form element
    endcomment
    assign search_form_element = 'predictive-search'

    comment
      Types of results to show
    endcomment
    capture resourceTypes
      if settings.predictive_search_articles
        echo 'article' | prepend: ','
      endif
      if settings.predictive_search_collections
        echo 'collection' | prepend: ','
      endif
      if settings.predictive_search_pages
        echo 'page' | prepend: ','
      endif
      if settings.predictive_search_products
        echo 'product' | prepend: ','
      endif
    endcapture
    assign resourceTypes = resourceTypes | remove_first: ','
  endif
-%}

{% comment %} Close trigger {% endcomment %}
<class-toggle-component
  data-options='
    {
      "classToToggle": "search-is-open",
      "ariaExpanded": true
    }
  '>
  <button
    type="button"
    class="-me-6 -mt-6 ms-auto block cursor-pointer p-3 states:text-primary no-js:hidden lg:absolute lg:end-0 lg:top-3 lg:z-10 lg:mb-0 lg:me-[var(--content-wrapper-padding)] lg:ms-0 lg:mt-0"
    aria-label="{% render "render-translation", namespace: "accessibility", key: "close", fallback: "Close" %}">
    {%- render 'icons', icon: 'close', icon_class: 'w-6' -%}
  </button>
</class-toggle-component>

{%- comment -%} Render search form {%- endcomment -%}
<{{ search_form_element }} class="relative block">
  <form
    action="{{ routes.search_url }}"
    method="get"
    role="search"
    class="search-modal__form relative mx-auto w-full lg:max-w-2xl">
    <div class="search-field relative mb-0 w-full">
      <label class="search-field__label hidden" for="{{ prefix }}SearchInModal">
        {%- render 'render-translation', namespace: 'general.search', key: 'search', fallback: 'Search' -%}
      </label>
      <input
        placeholder="{% render "render-translation", namespace: "general.search", key: "search", fallback: "Search" %}"
        class="search-field__input state:text-black block w-full appearance-none border border-x-transparent  border-t-transparent bg-transparent py-[5px] pe-6 ps-0 font-body leading-7 ring-transparent placeholder:text-black states:border-transparent states:border-b-secondary states:bg-transparent states:ring-transparent lg:border-b-transparent lg:pe-8 lg:text-base lg:states:border-b-transparent"
        id="{{ prefix }}SearchInModal"
        type="search"
        name="q"
        autofocus
        value="{{ search.terms | escape }}"
        {% if predictive_search_enabled %}
          data-predicative-search="input"
          autocomplete="off"
        {% endif %}>
      {%- comment -%} Extra options for search. {%- endcomment -%}
      <input type="hidden" name="options[prefix]" value="last">
    </div>

    {%- comment -%} Button for clear input field. {%- endcomment -%}
    <button
      type="button"
      class="absolute end-14 top-2/4 -translate-y-2/4 states:text-primary"
      data-predicative-search="reset"
      aria-label="{% render "render-translation", namespace: "general.search", key: "reset", fallback: "Reset" %}">
      {%- render 'icons', icon: 'cross', icon_class: 'w-4' -%}
    </button>

    {%- comment -%} Submit button. {%- endcomment -%}
    <button
      type="submit"
      class="search-modal__button absolute end-0 top-2/4 block -translate-y-2/4 cursor-pointer p-3 states:text-primary"
      aria-label="{% render "render-translation", namespace: "general.search", key: "search", fallback: "Search" %}">
      {%- render 'icons', icon: 'search', icon_class: 'w-6' -%}
    </button>
  </form>
  {%- if predictive_search_enabled == true -%}
    <div
      class="predictive-search"
      data-predicative-search="results"
      tabindex="-1"
      data-resources-types="{{- resourceTypes -}}"
      data-max-results="{{- max_results | default: 4 -}}"></div>
  {%- endif -%}
</{{ search_form_element }}>

{%- comment -%} Import predictive styles & Javascript when the section is enabled. {%- endcomment -%}
{%- if predictive_search_enabled -%}
  <script src="{{ 'predictive-search.js' | asset_url }}" defer></script>
{%- endif -%}
