{%- comment -%}
  Main collection product grid
  Accepts:
  - section:         {Object} main-collection.liquid section object (required)
{%- endcomment -%}

{%- assign container_title = section.settings.title | escape -%}

{%- liquid
  # check for filters
  assign filtered_collection = false
  for filter in collection.filters
    if filter.active_values.size > 0 or filter.max_value.value > 0 or filter.min_value.value > 0
      assign filtered_collection = true
      break
    endif
  endfor
-%}

{% comment %} Loader animation {% endcomment %}
{%- capture loading_overlay -%}
  <div class="loading-overlay absolute inset-0 z-50 flex hidden w-full items-center justify-center opacity-70 bg-color-default" data-loader>
    {%- render 'icons', icon: 'spinner', icon_class: 'w-6 animate-spin' -%}
  </div>
{%- endcapture -%}

{%- comment -%} Collection content {%- endcomment -%}
{%- capture container_content -%}
  <div
    id="CollectionProductGrid"
    class="group/collection relative"
  >
    {{ loading_overlay }}
    <div
      class="collection relative"
      id="main-collection-product-grid"
      data-collection-product-grid
      data-collection-handle="{{ collection.handle }}"
      data-id="{{ section.id }}"
    >
      {%- if collection.products.size == 0 -%}
        {% comment %} No products found {% endcomment %}
        <div class="text-center">
          <h3 class="h4">
            {%- render 'render-translation', namespace: 'sections.collection_template', key: 'empty', fallback: 'No products found.' -%}
          </h3>
          {%- if filtered_collection -%}
            <p>
              {{ 'sections.collection_template.use_fewer_filters_html' | t: link: collection.url }}
            </p>
          {%- endif -%}
        </div>
      {%- else -%}
        {%- liquid
          paginate collection.products by settings.products_per_page
            render 'product-grid', collection: collection, paginate: paginate, view: section.settings.pagination_view, product_card_extra_id: section.id

            if paginate.pages > 1 and section.settings.pagination_view == ''
              render 'pagination', paginate: paginate, anchor: '', class: ''
            endif
          endpaginate

          if section.settings.show_back_to_top == true
            render 'back-to-top'
          endif
        -%}
      {%- endif -%}
    </div>
  </div>
{%- endcapture -%}

{%- render 'render-container-content', class: 'collection-wrapper mt-0', title: container_title, content: container_content -%}

{%- comment -%} Import javascript {%- endcomment -%}
{%- if section.settings.pagination_view == 'load-more' -%}
  <script src="{{ 'load-more.js' | asset_url }}" defer></script>
{%- endif -%}
<script src="{{ 'product-card.js' | asset_url }}" type="module"></script>
<script src="{{ 'back-to-top.js' | asset_url }}" defer></script>
